# Thá»±c hÃ nh buá»•i 3

## 2. BÃ i táº­p 8

::: tip ğŸ’¡ MÃ” HÃŒNH

Cho mÃ´ hÃ¬nh nhÆ° sau : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-10-01-28-Screen%20Shot%202021-10-03%20at%2022.37.55.png" width="500">
:::

### Táº¡o thÆ° má»¥c vÃ  cÃ¡c file

Táº¡o cÃ¡c file vÃ  thÆ° má»¥c nhÆ° hÃ¬nh bÃªn dÆ°á»›i : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-10-06-00-Screenshot%20from%202021-10-04%2010-04-37.png">

Báº±ng cÃ¡ch thá»±c hiá»‡n cÃ¡c lá»‡nh sau: 

```sh
mkdir ~/Desktop/BaiTap8
cd ~/Desktop/BaiTap8
mkdir pc1 pc2 pc3 pc4 switch
touch pc1.startup pc2.startup pc3.startup pc4.startup switch.startup
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-10-09-06-Screen%20Shot%202021-10-04%20at%2010.09.01.png" width="600">

### Thiáº¿t láº­p cÃ¡c file

:::: tabs

  ::: tab lab.conf
  ```txt
  pc1[0]=A
  pc2[0]=B
  pc3[0]=C
  pc4[0]=D
  switch[0]=A
  switch[1]=B
  switch[2]=C
  switch[3]=D
  ```
  :::

  ::: tab pc1.startup
  ```txt
  ifconfig eth0 10.0.0.10/24 up
  ifconfig eth0 hw ether 00:00:00:00:00:10
  ```
  :::

  ::: tab pc2.startup
  ```txt
  ifconfig eth0 10.0.0.20/24 up
  ifconfig eth0 hw ether 00:00:00:00:00:20
  ```
  :::

  ::: tab pc3.startup
  ```txt
  ifconfig eth0 10.0.0.30/24 up
  ifconfig eth0 hw ether 00:00:00:00:00:30
  ```
  :::

  ::: tab pc4.startup
  ```txt
  ifconfig eth0 10.0.0.40/24 up
  ifconfig eth0 hw ether 00:00:00:00:00:40
  ```
  :::

  ::: tab switch.startup
  ```txt
  ifconfig eth0 up
  ifconfig eth0 hw ether 00:00:00:00:10:10
  ifconfig eth1 up
  ifconfig eth1 hw ether 00:00:00:00:20:20
  ifconfig eth2 up
  ifconfig eth2 hw ether 00:00:00:00:30:30
  ifconfig eth3 up
  ifconfig eth3 hw ether 00:00:00:00:40:40
  brctl addbr br0
  brctl addif br0 eth0
  brctl addif br0 eth1
  brctl addif br0 eth2
  brctl addif br0 eth3
  brctl stp br0 on
  ifconfig br0 up
  ```
  :::
::::

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-11-06-51-4f3ba542094ec010995f.jpg">

::: tip ğŸ¤” GIáº¢I THÃCH

- Chá»‰ sá»‘ in <mark>mÃ u vÃ ng</mark> lÃ  Ä‘á»‹a chá»‰ váº­t lÃ½

- `hw ether` lÃ  gáº¯n Ä‘á»‹a chá»‰ `MAC` cho máº¡ng

- Trong file `switch.startup` : 

  1. Táº¡o ra cáº§u ná»‘i tÃªn lÃ  `br0` vÃ  ná»‘i á»Ÿ cÃ¡c nhÃ¡nh khÃ¡c nhau

  2. Lá»‡nh `addbr` : táº¡o ra má»™t cáº§u ná»‘i ná»‘i (`br0`, `br1`...) Ä‘á»ƒ ná»‘i nhÃ¡nh `A`,`B`,`C` vÃ  `D` láº¡i

  3. Lá»‡nh `addif` : ÄÄƒng kÃ½ cÃ¡c cá»•ng cá»§a `switch` áº£o vÃ  cáº§u ná»‘i. CÃ¡c cá»•ng thuá»™c chung 1 cáº§u ná»‘i thÃ¬ truyá»n dá»¯ liá»‡u cho nhau

  4. Lá»‡nh `stp <name_of_bridge>` : KÃ­ch hoáº¡t giáº£i thuáº­t `STP` trÃªn má»™t cáº§u ná»‘i cá»§a `switch` áº£o

  5. Lá»‡nh `ifconfig <name_of_bridge>` : KÃ­ch hoáº¡t cáº§u ná»‘i (`br0`, `br1`...)
:::


### Khá»Ÿi táº¡o há»‡ thá»‘ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `Kathara` sau : 

```sh
kathara lstart pc1 pc2 pc3 pc4 switch
```

TrÃªn thiáº¿t bá»‹ `switch` sá»­ dá»¥ng `MAC Lookup Table` báº±ng lá»‡nh sau : 

```sh
brctl showmacs br0
```

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-10-55-01-Screenshot%20from%202021-10-04%2010-54-32.png">

TrÃªn mÃ¡y áº£o `pc1`, `pc3`, `switch` thá»±c hiá»‡n lá»‡nh `tcpdump` nhÆ° sau :

:::: tabs

  ::: tab pc1
  ```sh
  tcpdump -e -q -w /shared/BT8_pc1.pcap
  ```
  :::
  
  ::: tab pc2
  ```sh
  tcpdump -e -q -w /shared/BT8_pc2.pcap
  ```
  :::
  
  ::: tab switch
  ```sh
  tcpdump -e -q -w /shared/BT8_switch.pcap
  ```
  :::
::::

::: tip ğŸ¤” GIáº¢I THÃCH

- `-e` : Thay vÃ¬ hiá»ƒn thá»‹ Ä‘á»‹a chá»‰ `IP` sáº½ Ä‘Æ°á»£c thay tháº¿ báº±ng Ä‘á»‹a chá»‰ `MAC`

- `-q` : Hiá»ƒn thá»‹ Ã­t thÃ´ng tin hÆ¡n

- `-w` : Xuáº¥t file ra Ä‘Æ°á»ng dáº«n cá»¥ thá»ƒ
:::

Tá»« `pc2` thá»±c hiá»‡n ping tá»›i `pc3` báº±ng lá»‡nh `ping 10.0.0.30 -c 10`

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-11-42-42-Screen%20Shot%202021-10-04%20at%2011.42.31.png">

Thá»±c hiá»‡n gÃµ láº¡i lá»‡nh `brctl showmacs br0` trÃªn `switch` vÃ  xem khÃ¡c biá»‡t : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-11-44-44-Screenshot%20from%202021-10-04%2011-44-00.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

Sau khi sá»­ dá»¥ng lá»‡nh `ping` tá»« `switch` Ä‘Ã£ sÃ n lá»c láº¡i cÃ¡c Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a cÃ¡c mÃ¡y hiá»‡n cÃ³ vÃ  cáº­p nháº­t nÃ³ vÃ o trong `MAC Lookup Table`
:::

### PhÃ¢n tÃ­ch gÃ³i pcap trÃªn WireShark

Trong thÆ° má»¥c `shared` á»Ÿ `BaiTap8`, cÃ³ chá»©a cÃ¡c file `.pcap` Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n tÃ­ch trÆ°á»›c Ä‘Ã³

#### HÃ£y má»Ÿ file `BT8_switch.pcap` báº±ng `WireShark`: 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-12-55-11-Screenshot%20from%202021-10-04%2012-54-43.png">

##### Chá»n khung giao diá»‡n cÃ³ giao thá»©c `ARP` Ä‘áº¿n tá»« Ä‘á»‹a chá»‰ `MAC` : `00:00:00:00:00:20`

> TrÃªn hÃ¬nh lÃ  khung sá»‘ `8`

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- `Switch` nháº­n Ä‘Æ°á»£c khung dá»¯ liá»‡u nÃ y vÃ¬ `pc2` Ä‘Ã£ **ping** tá»›i `pc3`. `pc2` truyá»n thÃ´ng Ä‘iá»‡p tá»›i `switch` Ä‘á»ƒ tÃ¬m Ä‘á»‹a chá»‰ `MAC` cá»§a `pc3`

- Khung dá»¯ liá»‡u nÃ y cÃ³ Ã½ nghÄ©a `switch` Ä‘Ã£ nháº­n Ä‘Æ°á»£c yÃªu cáº§u tÃ¬m Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a `pc3` mÃ  `pc2` gá»­i tá»›i
:::

##### Chá»n khung giao diá»‡n cÃ³ giao thá»©c `ARP` Ä‘áº¿n tá»« Ä‘á»‹a chá»‰ `MAC` : `00:00:00:00:00:30`

> TrÃªn hÃ¬nh lÃ  khung sá»‘ `9`

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-12-59-03-Screen%20Shot%202021-10-04%20at%2012.58.53.png">


::: tip ğŸ’¡ NHáº¬N XÃ‰T

- `Switch` nháº­n Ä‘Æ°á»£c khung dá»¯ liá»‡u nÃ y vÃ¬ Ä‘Ã£ tÃ¬m tháº¥y Ä‘Æ°á»£c Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a `pc3`

- Khung dá»¯ liá»‡u nÃ y cÃ³ Ã½ nghÄ©a lÃ  `switch` Ä‘Ã£ gá»­i Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a `pc3` tá»›i `pc2`
:::

#### Má»Ÿ file `BT8_pc1.pcap` báº±ng `WireShark`

##### Chá»n khung dá»¯ liá»‡u cÃ³ giao thá»©c `ARP` Ä‘áº¿n tá»« Ä‘á»‹a chá»‰ MAC `00:00:00:00:00:20`

> TrÃªn hÃ¬nh lÃ  khung `43`

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-13-03-30-Screen%20Shot%202021-10-04%20at%2013.03.25.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- `pc1` nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u nÃ y vÃ¬ `switch` truyá»n quáº£ng bÃ¡ khung dá»¯ liá»‡u ra táº¥t cáº£ cÃ¡c cá»•ng Ä‘á»ƒ tÃ¬m Ä‘Æ°á»£c Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a `pc3`

- Khung dá»¯ liá»‡u nÃ y cÃ³ Ã½ nghÄ©a `pc1` sáº½ khÃ´ng há»“i Ä‘Ã¡p vÃ¬ `10.0.0.30` khÃ´ng pháº£i lÃ  IP cá»§a `pc1`
:::

#### Má»Ÿ file `BT8_pc3.pcap` báº±ng `WireShark`

##### Chá»n khung dá»¯ liá»‡u cÃ³ giao thá»©c `ARP` Ä‘áº¿n tá»« Ä‘á»‹a chá»‰ MAC `00:00:00:00:00:20`

> TrÃªn hÃ¬nh lÃ  khung `30`

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-13-07-25-Screen%20Shot%202021-10-04%20at%2013.07.17.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- `pc3` nháº­n Ä‘Æ°á»£c khung nÃ y vÃ¬ `switch` truyá»n bÃ¡ khung dá»¯ liá»‡u ra táº¥t cáº£ cÃ¡c cá»•ng Ä‘á»ƒ tÃ¬m Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a `pc3`

- `pc3` sáº½ pháº£n há»“i khung nÃ y, vÃ¬ Ä‘á»‹a chá»‰ cá»§a `pc3` lÃ  `10.0.0.30` khá»›p vá»›i Ä‘á»‹a chá»‰ `switch` Ä‘ang tÃ¬m kiáº¿m
:::

---

::: tip ğŸ“ Káº¾T LUáº¬N

- Sau khi thá»±c hiá»‡n `ping` giá»¯a 2 mÃ¡y áº£o cÃ³ cÃ¹ng `switch` thÃ¬ `switch` sáº½ truyá»n dá»¯ liá»‡u tÃ¬m kiáº¿m Ä‘áº¿n táº¥t cáº£ cÃ¡c thiáº¿t bá»‹ Ä‘Æ°á»£c `switch` ná»‘i káº¿t trong cÃ¹ng máº¡ng `LAN`

- Sau Ä‘Ã³ `switch` **há»c** Ä‘Æ°á»£c Ä‘á»‹a chá»‰ váº­t lÃ½ cá»§a cÃ¡c mÃ¡y tÃ­nh Ä‘Ã³ vÃ  cáº­p nháº­t vÃ o trong `MAC Lookup Table`
:::

### Huá»· há»‡ thÃ³ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ huá»· há»‡ thá»‘ng mÃ¡y áº£o vá»«a táº¡o : 

```sh
kathara wipe
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-13-13-37-Screen%20Shot%202021-10-04%20at%2013.13.33.png" width="600">

## 3. BÃ i táº­p 9

::: tip ğŸ’¡ MÃ” HÃŒNH

XÃ¢y dá»¥ng mÃ´ hÃ¬nh máº¡ng nhÆ° sau : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/04-13-14-34-Screen%20Shot%202021-10-04%20at%2013.14.27.png">
:::

## 4. BÃ i táº­p 10

## 5. BÃ i táº­p 11

# Thá»±c hÃ nh buá»•i 4

::: tip ğŸ“ Äá»€ BÃ€I

<div class="pdfZen">
  <iframe src="https://drive.google.com/file/d/1yC_AMzdyaNDbFktZ4c_-FTfnK1b0Bt1z/preview"></iframe>
</div>
:::

## Kiáº¿n thá»©c

### Äá»‹nh tuyáº¿n ná»™i miá»n

- LÃ  nhÃ³m cÃ¡c máº¡ng `LAN` vÃ  `router` cÃ³ chung chÃ­nh sÃ¡ch quáº£n trá»‹.

- CÃ¡c giáº£i thuáº­t mÃ  `router` sá»­ dá»¥ng Ä‘á»ƒ váº¡ch Ä‘Æ°á»ng gá»i lÃ  `IGP` (*Interior GateWay Protocol*).

::: tip ğŸ’¡ Giáº£i thuáº­t <code>RIP</code> vÃ   <code>OSPF</code>

- `RIP` (*[Routing Information Protocol](https://en.wikipedia.org/wiki/Routing_Information_Protocol))*: sá»­ dá»¥ng giáº£i thuáº­t `Distance Vector` (*theo nguyÃªn lÃ½ [bellman-Ford](https://vi.wikipedia.org/wiki/Thu%E1%BA%ADt_to%C3%A1n_Bellman%E2%80%93Ford)*), phiÃªn báº£n `RIP` version **2**:

  1. ÄÆ¡n vá»‹ Ä‘o khoáº£ng cÃ¡ch dÃ¹ng trong váº¡ch Ä‘Æ°á»ng lÃ  `hops`

  2. Sá»‘ lÆ°á»£ng sá»‘ bÆ°á»›c nháº£y tá»‘i Ä‘a lÃ  `15`

  3. ChÃ¹ ká»³ cáº­p nháº­t báº£ng váº¡ch Ä‘Æ°á»ng lÃ  `30s` (*cÃ³ thá»ƒ tÃ¹y chá»‰nh*)

  4. Táº§ng váº­n chuyá»ƒn sá»­ dá»¥ng [UDP](https://vi.wikipedia.org/wiki/UDP) vá»›i cá»•ng lÃ  `520`

  5. Há»— trá»£ [CIDR](https://quantrimang.com/cidr-la-gi-165535) vÃ  [MD5](https://vi.wikipedia.org/wiki/MD5)

  ==> PhÃ¹ há»£p triá»ƒn khai trÃªn cÃ¡c **Ä‘á»‹nh tuyáº¿n ná»™i miá»n** cÃ³ kÃ­ch thÆ°á»›c nhá» vÃ  khÃ´ng phá»©c táº¡p

- `OSPF` (*[Open Shortest Path First](https://vi.wikipedia.org/wiki/OSPF)*): sá»­ dá»¥ng giáº£i thuáº­t `LSP` (*Link State Packet*) dá»±a trÃªn thuáº­t toÃ¡n [Dijkstra](https://vi.wikipedia.org/wiki/Thu%E1%BA%ADt_to%C3%A1n_Dijkstra), phiÃªn báº£n `OSPF` version **2**

  1. Há»™i tá»¥ nhanh vÃ  khÃ´ng cÃ³ tÃ¬nh tráº·ng láº·p vÃ´ táº­n viá»‡c váº¡ch Ä‘Æ°á»ng
  
  2. Há»— trá»£ máº¡ng kÃ­ch thÆ°á»›c lá»›n

  3. Há»— trá»£ [CIDR](https://quantrimang.com/cidr-la-gi-165535) vÃ  [MD5](https://vi.wikipedia.org/wiki/MD5)

  ==> PhÃ¹ há»£p triá»ƒn khai trÃªn cÃ¡c **Ä‘á»‹nh tuyáº¿n ná»™i miá»n** cÃ³ kÃ­ch thÆ°á»›c lá»›n vÃ  phá»©c táº¡p
:::

::: warning âš ï¸ LÆ¯U Ã

- Trong `kathara` Ä‘á»ƒ sá»­ dá»¥ng **Ä‘á»‹nh tuyáº¿n ná»™i miá»n** sá»­ dá»¥ng cÃ´ng cá»¥ cÃ³ sáºµn lÃ  `Quagga`: lÃ  dá»‹ch vá»¥ chá»©a cÃ¡c giáº£i thuáº­t váº¡ch Ä‘Æ°á»ng nhÆ° `RIPv2` vÃ  `OSPFv2` hoáº¡t Ä‘á»™ng tá»‘t trÃªn `IPv4`, `IPv6`...

- ÄÆ°á»£c cÃ i Ä‘áº·t táº¡i Ä‘Æ°á»ng dáº«n `/etc/quagga` trong mÃ¡y áº£o `Kathara`
:::

## 1.BÃ i táº­p 12

::: tip ğŸ’¡ MÃ” HÃŒNH

XÃ¢y dá»±ng há»‡ thá»‘ng máº¡ng vá»›i mÃ´ hÃ¬nh nhÆ° sau : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/17-18-52-12-Screen%20Shot%202021-10-17%20at%2018.52.04.png">
:::

### Táº¡o thÆ° má»¥c vÃ  cÃ¡c file


```sh
mkdir ~/Desktop/BaiTap12
cd ~/Desktop/BaiTap12
mkdir router1 router2 router3 router4 
touch lab.conf router1.startup router2.startup router3.startup router4.startup
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-16-57-29-Screenshot%20from%202021-10-31%2014-36-10.png" width="500">

### Thiáº¿t láº­p cÃ¡c file

:::: tabs

  ::: tab lab.conf
  ```txt
  router1[0]=H
  router1[1]=G
  router1[2]=E
  router1[3]=A

  router2[0]=E
  router2[1]=F
  router2[2]=B

  router3[0]=F
  router3[1]=G
  router3[2]=I
  router3[3]=C

  router4[0]=D
  router4[1]=I
  router4[2]=H
  ```
  :::

  ::: tab router1.startup
  ```txt
  ifconfig eth0 100.1.0.13/30 up
  ifconfig eth1 100.1.0.9/30 up
  ifconfig eth2 100.1.0.1/30 up
  ifconfig eth3 100.1.1.1/24 up
  /etc/init.d/quagga start
  ```
  :::

  ::: tab router2.startup
  ```txt
  ifconfig eth0 100.1.0.2/30 up
  ifconfig eth1 100.1.2.1/24 up
  ifconfig eth2 100.1.2.1/24 up
  /etc/init.d/quagga start
  ```
  :::
  
  ::: tab router3.startup
  ```txt
  ifconfig eth0 100.1.0.6/30 up
  ifconfig eth1 100.1.0.10/30 up
  ifconfig eth2 100.1.0.17/30 up
  ifconfig eth3 100.1.3.1/24 up
  /etc/init.d/quagga start
  ```
  :::

  ::: tab router4.startup
  ```txt
  ifconfig eth0 100.1.4.1/24 up
  ifconfig eth1 100.1.0.18/30 up
  ifconfig eth2 100.1.0.14/30 up
  /etc/init.d/quagga start
  ```
  :::
::::

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-15-22-49-Screen%20Shot%202021-10-31%20at%2015.22.42.png" width="600">

::: tip ğŸ’¡ Giáº£i thÃ­ch

Lá»‡nh `etc/init.d/quagga start`: Ä‘á»ƒ khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥ `Quagga`
:::
### Cáº¥u hÃ¬nh `Quagga`

Trong má»—i thÆ° viá»‡n `router` hÃ£y táº¡o thÆ° má»¥c vÃ  cáº¥u hÃ¬nh nhÆ° sau : 

```txt-no:no-line-numbers
-- router1
   -- etc
      -- quagga
       + daemons
       + ripd.conf
       + zebra.conf
```

:::: tabs

  ::: tab daemons
  ```txt
  zebra=yes
  ripd=yes
  ```
  :::

  ::: tab zebra.conf
  ```txt
  hostname zebra
  password zebra
  enable password zebra
  log file /var/log/zebra/zebra.log
  ```
  :::

  ::: tab rip.conf
  ```txt
  hostname ripd
  password zebra
  enable password zebra

  router rip
  network 100.1.0.0/16
  redistribute connected
  log file /var/log/zebra/ripd.log
  ``` 
  :::
::::

::: tip ğŸ’¡ GIáº¢I THÃCH

- `zebra.conf`: chá»©a ná»™i dung miÃªu táº£ cho cÃ´ng cá»¥ `Quagga` nhÆ° : 
  
  1. username vÃ  password

  2. ÄÆ°á»ng dáº«n nháº­t kÃ½ (`log file`)

- `daemons`: chá»©a khai bÃ¡o cÃ¡c giao thá»©c váº¡ch Ä‘Æ°á»ng Ä‘Æ°á»£c `Quagga` há»— trá»£ nhÆ° :

  1. `RIPv2` trÃªn `IPv4`: Ä‘áº·t tÃªn lÃ  `ripd`

  2. `OSPFv2` trÃªn `IPv4`: Ä‘áº·t tÃªn lÃ  `ospfd`

  3. `BGP` trÃªn `IPv4` vÃ  `IPv6`: Ä‘áº·t tÃªn lÃ  `bgpd`

- `ripd.conf`: chá»©a ná»™i dung miÃªu táº£ hoáº¡t Ä‘á»™ng cá»§a giáº£i thuáº­t `RIPv2`

  1. Lá»‡nh `router rip`: cho biáº¿t router sáº½ sá»­ dá»¥ng `RIPv2` lÃ m váº¡ch Ä‘Æ°á»ng 

  2. Lá»‡nh `network`: lÃ  pháº¡m vi gá»­i vÃ  nháº­n gÃ³i tin, cÃ³ thá»ƒ sá»­ dá»¥ng `ip` khÃ¡c dÆ°á»›i `24`

  3. Lá»‡nh `redistribute connected`: cho phÃ©p router Ä‘Ã³ng gÃ³i cÃ¡c thÃ´ng tin vá» nhá»¯ng nhÃ¡nh máº¡ng 
:::

::: tip ğŸ’¡  Máº¸O

Sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ copy qua cÃ¡c router cÃ²n láº¡i 

```sh
cp -r router1/etc router2
cp -r router1/etc router3
cp -r router1/etc router4
```
:::

Sá»­ dá»¥ng lá»‡nh `tree` Ä‘á»ƒ xem cáº¥u trÃºc file (*cÃ i báº±ng lá»‡nh sau:* `sudo apt install tree`)

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-17-33-18-Screen%20Shot%202021-10-31%20at%2017.33.08.png" width="250">

### Khá»Ÿi Ä‘á»™ng mÃ¡y áº£o

Sá»­ dá»¥ng dá»¥ng lá»‡nh sau Ä‘á»ƒ khá»Ÿi táº¡o cÃ¡c mÃ¡y áº£o `Kathara` vá»«a khá»Ÿi táº¡o :

```sh
kathara lstart
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-13-38-21-Screen%20Shot%202021-10-31%20at%2017.40.46.png">
>
> Váº­y lÃ  báº¡n Ä‘Ã£ sá»­ dá»¥ng dá»‹ch vá»¥ `Quagga` thÃ nh cÃ´ng.

Sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ kiá»ƒm tra dá»‹ch vá»¥ `Quagga`

```sh
/etc/init.d/quagga status
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-13-41-18-Screen%20Shot%202021-11-01%20at%2013.41.12.png">
>
> 1. Náº¿u khÃ´ng hiá»‡n gÃ¬ cáº£ ==> dá»‹ch vá»¥ chÆ°a Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng
>
> 2. `ripd watchquagga` ==> thiáº¿t láº­p cho `RIPv2` vÃ  `Quagga` Ä‘Ã£ thÃ nh cÃ´ng
>
> 3. `watchquagga` ==> cÃ³ sai sÃ³t trÃªn `ripd.conf` nÃªn `RIPv2` khÃ´ng hoáº¡t Ä‘á»™ng

### Nháº­n xÃ©t mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `route` Ä‘á»ƒ kiá»ƒm tra váº¡ch Ä‘Æ°á»ng trÃªn cÃ¡ch mÃ¡y áº£o :

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-15-51-55-Screen%20Shot%202021-11-01%20at%2015.51.50.png">

#### Kiá»ƒm tra ping 

Tá»« `router1` hÃ£y ping tá»›i `router4` vÃ  tá»« `router2` Ä‘áº¿n `router4` báº±ng lá»‡nh sau:

```sh
# thá»±c hiá»‡n trÃªn pc1
ping 100.1.4.1 -c 5 
# thá»±c hiá»‡n trÃªn pc2
ping 100.1.0.10 -c 5
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-15-54-40-Screen%20Shot%202021-11-01%20at%2015.54.36.png">

#### Kiá»ƒm tra `tcpdump`

Sá»­ dá»¥ng lá»‡nh `tcpdump` sau Ä‘Ã¢y trÃªn `router1` Ä‘á»ƒ kiá»ƒm tra Ä‘Æ°á»ng Ä‘i cÃ¡c gÃ³i tin

```sh
tcmpdump -i any -w /shared/BaiTap12_router1.pcap
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-03-06-Screen%20Shot%202021-11-01%20at%2016.02.55.png">

::: warning âš ï¸ LÆ¯U Ã

Sá»­ dá»¥ng `CRTL+C` Ä‘á»ƒ dá»«ng sau táº§m `20s`
:::

#### Kiá»ƒm tra `telnet`

TrÃªn `router` báº¥t ká»³ sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ Ä‘Äƒng nháº­p vÃ o dá»‹ch vá»¥ `RIPv2`:

```sh
telnet localhost ripd
```

> Password : `zebra`
 
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-56-04-Screen%20Shot%202021-11-01%20at%2016.55.57.png">

Sau Ä‘Ã³ trÃªn giao diá»‡n `ripd`, sá»­ dá»¥ng lá»‡nh:

```sh
show ip rip
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-58-08-Screen%20Shot%202021-11-01%20at%2016.58.05.png">

### PhÃ¢n tÃ­ch pcap báº±ng WireShark

Má»Ÿ gÃ³i `BaiTap12_router1.pcap` trong thÆ° má»¥c `shared` báº±ng `WireShark` vÃ  chá»n gÃ³i tin cÃ³ Ä‘á»‹a chá»‰ `100.1.0.10` (*router3*)

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-24-37-Screen%20Shot%202021-11-01%20at%2017.23.43.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- Äá»‹a chá»‰ IP Ä‘Ã­ch cá»§a khung nÃ y lÃ  `224.0.0.9`, nÃ³ lÃ  Ä‘á»‹a chá»‰ `Multicast` (*vÃ¬ cÃ¡c `packages` gá»­i Ä‘áº¿n nhá»¯ng Ä‘Ã­ch mÃ  nÃ³ cÃ¹ng giao thá»©c máº¡ng vá»›i nguá»“n*)

- GÃ³i tin sá»­ dá»¥ng giao thá»©c trÃªn **táº§ng váº­n chuyá»ƒn lÃ ** `user datagram`, vÃ  hoáº¡t Ä‘á»™ng á»Ÿ cá»•ng `520`

- Trong trÆ°á»ng `Routing Infomation Protocol` Ä‘Ã¢y lÃ  bá»™ Ä‘á»‹nh tuyáº¿n sá»­ dá»¥ng giáº£i thuáº­t `RIPv2`

- NgoÃ i gÃ³i tin `RIPv2` cÃ³ Ä‘á»‹a chá»‰ `100.1.0.10` thÃ¬ `router3` cÃ²n nháº­n dá»¯ liá»‡u cá»§a cÃ¡c `router 1`, `routere2` vÃ  `router4`
:::

### Táº¯t má»™t nhÃ¡nh máº¡ng

TrÃªn `router1` thá»±c hiá»‡n táº¯t nhÃ¡nh máº¡ng `eth1` báº±ng lá»‡nh

```sh
ifconfig eth1 down
```

> Äiá»u nÃ y sáº½ lÃ m cho mÃ´ hÃ¬nh máº¡ng nhÆ° sau:
> 
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-30-09-Screen%20Shot%202021-11-01%20at%2017.29.39.png" width="500">

TrÃªn `router1` thá»±c hiá»‡n **ping** tá»›i `router3` báº±ng lá»‡nh

```sh
ping 100.1.0.10 -c 7
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-32-43-Screen%20Shot%202021-11-01%20at%2017.32.38.png">
>
> KhÃ´ng thÃ nh cÃ´ng vÃ¬ lÃºc nÃ y Ä‘Ã£ máº¥t Ä‘Æ°á»ng liÃªn káº¿t tá»›i `router3`

Thá»±c hiá»‡n kiá»ƒm tra báº£ng váº¡ch Ä‘Æ°á»ng báº±ng `route` cá»§a `router1`:

| CÅ©                                                                                                                                                                      | Má»›i                                                                                                                                                                     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-35-14-Screen%20Shot%202021-11-01%20at%2017.35.03.png" width="600"> | <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-34-24-Screen%20Shot%202021-11-01%20at%2017.34.16.png" width="600"> |

==> Cá»¥ thá»ƒ khÃ´ng cÃ²n liÃªn káº¿t nÃ o á»Ÿ `eth1` nhÆ° trÃªn, giao diá»‡n `eth2` cá»§a `router1` sáº½ thay tháº¿ giao diá»‡n `eth1` Ä‘Ã£ bá»‹ táº¯t Ä‘i

::: tip Káº¾T LUáº¬N

Giáº£i thuáº­t `RIPv2` trÃªn `router` tá»± Ä‘á»™ng cáº­p nháº­t láº¡i Ä‘Æ°á»ng Ä‘i khi cáº¥u trÃºc máº¡ng thay Ä‘á»•i Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘Æ°á»ng truyá»n táº£i vá»›i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t vÃ  khÃ´ng bá»‹ máº¥t mÃ¡t dá»¯ liá»‡u
:::

### Há»§y mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `kathara` sau Ä‘á»ƒ há»§y há»‡ thá»‘ng mÃ¡y áº£o

```sh
kathara lclean
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-40-06-Screen%20Shot%202021-11-01%20at%2017.40.02.png" width="600">

## 2.BÃ i táº­p 13

::: tip ğŸ’¡ MÃ” HÃŒNH

XÃ¢y dá»±ng mÃ¡y áº£o theo mÃ´ hÃ¬nh sau Ä‘Ã¢y :

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/02-14-44-48-Screen%20Shot%202021-11-02%20at%2014.44.40.png">

:::
### Táº¡o thÆ° má»¥c vÃ  cÃ¡c file

XÃ¢y dá»±ng mÃ´ hÃ¬nh máº¡ng nhÆ° dÆ°á»›i Ä‘Ã¢y: 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-14-56-53-Screenshot%20from%202021-11-03%2014-54-36.png" width="600">

Báº±ng cÃ¡c lá»‡nh sau :

```sh
mkdir ~/Desktop/BaiTap13
cd ~/Desktop/BaiTap13
mkdir router1 router2 router3 router4
touch lab.conf router1.startup router2.startup router3.startup router4.startup
```

### Thiáº¿t láº­p cÃ¡c file

Cáº¥u hÃ¬nh vÃ  thiáº¿t láº­p cÃ¡c file nhÆ° sau:

:::: tabs

  ::: tab lab.conf
  ```txt
  router1[0]=H
  router1[1]=G
  router1[2]=E
  router1[3]=A

  router2[0]=E
  router2[1]=F
  router2[2]=B

  router3[0]=F
  router3[1]=G
  router3[2]=I
  router3[3]=C

  router4[0]=D
  router4[1]=I
  router4[2]=H
  ```
  :::

  ::: tab router1.startup
  ```txt
  ifconfig eth0 100.1.0.13/30 up
  ifconfig eth1 100.1.0.9/30 up
  ifconfig eth2 100.1.0.1/30 up
  ifconfig eth3 100.1.1.1/24 up
  /etc/init.d/quagga start 
  ```
  :::

  ::: tab router2.startup
  ```txt
  ifconfig eth0 100.1.0.2/30 up
  ifconfig eth1 100.1.0.5/30 up
  ifconfig eth2 100.1.2.1/24 up
  /etc/init.d/quagga start
  ```
  :::

  ::: tab router3.startup
  ```txt
  ifconfig eth0 100.1.0.6/30 up
  ifconfig eth1 100.1.0.10/30 up
  ifconfig eth2 100.1.0.17/30 up
  ifconfig eth3 100.1.3.1/24 up
  /etc/init.d/quagga start 
  ```
  :::

  ::: tab router4.startup
  ```txt
  ifconfig eth0 100.1.4.1/24 up
  ifconfig eth1 100.1.0.18/30 up
  ifconfig eth2 100.1.0.14/30 up
  /etc/init.d/quagga start
  ```
  :::
::::

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-14-51-06-Screen%20Shot%202021-11-03%20at%2014.51.01.png">

### Cáº¥u hÃ¬nh `Quagga`

Trong má»—i thÆ° viá»‡n `router` hÃ£y táº¡o thÆ° má»¥c nhÆ° sau:

:::: tabs

  ::: tab daemons
  ```txt
  zebra=yes
  ospfd=yes
  ```
  :::

  ::: tab zebra.conf
  ```txt
  hostname zebra
  password zebra
  enable password zebra
  log file /var/log/zebra/zebra.log
  ```
  :::

  ::: tab ospfd.conf
  ```txt
  hostname ospfd
  password zebra
  enable password zebra

  interface eth0
  ospf cost 30

  interface eth1
  ospf cost 80

  interface eth2
  ospf cost 20

  router ospf
  network 100.1.0.0/16 area 0.0.0.0
  redistribute connected
  
  log file /var/log/zebra/ospfd.log
  ```
  :::
::::

::: tip ğŸ’¡  Máº¸O

Sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ copy qua cÃ¡c router cÃ²n láº¡i 

```sh
cp -r router1/etc router2
cp -r router1/etc router3
cp -r router1/etc router4
```
:::

> Sá»­ dá»¥ng `tree` Ä‘á»ƒ kiá»ƒm tra cáº¥u trÃºc cá»§a cÃ¡c thÆ° má»¥c
>
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-06-55-Screen%20Shot%202021-11-03%20at%2015.06.48.png" width="180">

::: tip ğŸ’¡ GIáº¢I TÃCH
- Táº¡o file `ospfd.conf` thay vÃ¬ `ripd.conf` vÃ¬ chÃºng ta sá»­ dá»¥ng giáº£i thuáº­t `OSPFv2` thay vÃ¬ `RIPv2`

- Lá»‡nh `interface` chá»‰ ra giao diá»‡n cá»§a `router` sáº½ cháº¡y giáº£i thuáº­t `OSPFv2`
:::

### Khá»Ÿi Ä‘á»™ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `kathara lstart` Ä‘á»ƒ khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng mÃ¡y áº£o vá»«a táº¡o:

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-39-12-Screen%20Shot%202021-11-03%20at%2015.39.08.png">
>
> ==> KhÃ´ng cÃ³ lá»—i gÃ¬ xáº£y ra trÃªn má»—i `router`, cÃ¡c cáº¥u hÃ¬nh Ä‘Ã£ chuáº©n 

Sá»­ dá»¥ng lá»‡nh sau trÃªn tá»«ng `router` Ä‘á»ƒ kiá»ƒm tra dá»‹ch vá»¥ `Quagga` vá»«a táº¡o:

```sh
/etc/init.d/quagga status
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-40-53-Screen%20Shot%202021-11-03%20at%2015.40.48.png">

::: warning âš ï¸ LÆ¯U Ã

- Náº¿u hiá»‡n `ospfd watchquagga zebra`: dá»‹ch vá»¥ `Quagga` Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng vÃ  Ä‘ang dÃ¹ng giáº£i thuáº­t `OSFPv2`

- Náº¿u khÃ´ng hiá»‡n gÃ¬ háº¿t thÃ¬ dá»‹ch vá»¥ `Quagga` Ä‘Ã£ xáº£y ra lá»—i

- Náº¿u hiá»‡n `watchquagga` thÃ¬ cÃ³ sai sÃ³t trÃªn `ospfd.conf` nÃªn `OSFPv2` khÃ´ng hoáº¡t Ä‘á»™ng
:::

### Nháº­n xÃ©t mÃ¡y áº£o

#### Kiá»ƒm tra váº¡ch Ä‘Æ°á»ng

Sá»­ dá»¥ng lá»‡nh `route` trÃªn tá»«ng `router` Ä‘á»ƒ kiá»ƒm tra báº£ng váº¡ch Ä‘Æ°á»ng:

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-45-56-Screen%20Shot%202021-11-03%20at%2015.45.53.png">

#### Kiá»ƒm tra sá»± liÃªn thÃ´ng 

Thá»±c hiá»‡n kiá»ƒm tra sá»± liÃªn thÃ´ng giá»¯a cÃ¡c `router` báº±ng lá»‡nh `ping` 

- Tá»« `router1` tá»›i `router4`

- Tá»« `router2` tá»›i `router3`

Báº±ng lá»‡nh sau Ä‘Ã¢y:

```sh
# thá»±c hiá»‡n trÃªn router1
ping 100.1.4.1 -c 5
# thá»±c hiá»‡n trÃªn router 2
ping 100.1.0.10 
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-48-43-Screen%20Shot%202021-11-03%20at%2015.48.39.png">

==> Kiá»ƒm tra thÃ nh cÃ´ng

### Kiá»ƒm tra Ä‘Æ°á»ng Ä‘i

TrÃªn `router1` thá»±c hiá»‡n cÃ¡c lá»‡nh nhÆ° sau:

```sh
traceroute 100.1.0.5  # eth1 cá»§a router2
traceroute 100.1.0.17 # eth2 cá»§a router3
traceroute 100.1.0.10 # eth1 cá»§a router3
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-15-52-15-Screen%20Shot%202021-11-03%20at%2015.51.45.png">


::: tip ğŸ’¡ NHáº¬N XÃ‰T

Nhá» giáº£i thuáº­t `OSPFv2` tÄƒng kháº£ nÄƒng má»Ÿ rá»™ng vÃ  há»™i tá»¥ nhanh mÃ  `router1` Ä‘i qua cÃ¡c nhÃ¡nh máº¡ng cá»§a `router2` vÃ  `router3` khÃ´ng cÃ³ nhÃ¡nh máº¡ng trung gian nÃ o
:::

#### Báº¯t cÃ¡c gÃ³i tin

TrÃªn `router` thá»±c hiá»‡n lá»‡nh sau Ä‘Ã¢y Ä‘á»ƒ báº¯t cÃ¡c gÃ³i tin

```sh
tcpdump -i any -w /shared/BaiTap13_router1.pcap
```

> Dá»«ng láº¡i sau `30s` báº±ng lá»‡nh `CRTL+C`
>
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-16-03-32-Screen%20Shot%202021-11-03%20at%2016.03.28.png">

Má»Ÿ thÆ° má»¥c `BaiTap12_router1.pcap` vá»«a táº¡o báº±ng `WireShark` vÃ  chá»n IP nguá»“n `100.1.0.2`:

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-16-11-31-Screen%20Shot%202021-11-03%20at%2016.10.56.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- Äá»‹a chá»‰ IP cá»§a khung nÃ y lÃ  `224.0.0.5`, vÃ  Ä‘Ã¢y lÃ  Ä‘á»‹a chá»‰ `Multicast` (*vÃ¬ cÃ¡c `packages` gá»­i Ä‘áº¿n nhá»¯ng Ä‘Ã­ch mÃ  nÃ³ cÃ¹ng giao thá»©c máº¡ng vá»›i nguá»“n*)

- GÃ³i tin nÃ y dÃ¹ng giao thá»©c `Open Shortest Path First` trÃªn táº§ng váº­n chuyá»ƒn

- Trong má»¥c `OSPF`:

  1. Hiá»‡n thuáº­t toÃ¡n `OSPF` Ä‘ang sá»­ dá»¥ng lÃ  `version 2`

  2. `Active Neighbor` lÃ  danh sÃ¡ch cÃ¡c bá»™ Ä‘á»‹nh tuyáº¿n lÃ¢n cáº­n hoáº·c liá»n ká»

  3. `Designated Router` lÃ  bá»™ Ä‘á»‹nh tuyáº¿n liá»n ká» vá»›i bá»™ Ä‘á»‹nh tuyáº¿n hiá»‡n táº¡i

  4. `Backup Designated Router` phá»¥c vá»¥ nhÆ° má»™t cháº¿ Ä‘á»™ chá» Ä‘á»ƒ nháº­n cáº­p nháº­t cÃ¡c bá»™ Ä‘á»‹nh tuyáº¿n hiá»‡n táº¡i
:::

### Táº¯t má»™t nhÃ¡nh máº¡ng

TrÃªn `router1` hÃ£y táº¯t nhÃ¡nh máº¡ng `eth1` báº±ng lá»‡nh sau:

```sh
ifconfig eth1 down
```

Sau Ä‘Ã³ hÃ£y `ping` tá»›i `router3` báº±ng lá»‡nh: `ping 100.1.0.10 -c 5`

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-16-34-09-Screen%20Shot%202021-11-03%20at%2016.33.56.png">

==> Ping váº«n thÃ nh cÃ´ng, tuy báº£ng váº¡ch Ä‘Æ°á»ng Ä‘Ã£ thay Ä‘á»•i vÃ  khÃ´ng cÃ²n `eth1`

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-16-36-05-Screen%20Shot%202021-11-03%20at%2016.35.55.png">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

Giáº£i thuáº­t `OSPFv2` trÃªn `router` tá»± Ä‘á»™ng cáº­p nháº­t láº¡i Ä‘Æ°á»ng báº±ng má»™t Ä‘Æ°á»ng Ä‘i má»›i, Ä‘á»ƒ Ä‘áº£m báº±ng tÃ­nh liÃªn thÃ´ng cá»§a cÃ¡c `router` vÃ  chi phÃ­ ngáº¯n nháº¥t Ä‘á»ƒ tá»« `router` Ä‘áº¿n cÃ¡c `router` cÃ²n láº¡i.
:::

### Há»§y há»‡ thá»‘ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `kathara lclean` Ä‘á»ƒ há»§y há»‡ thá»‘ng mÃ¡y áº£o:

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-16-55-34-Screen%20Shot%202021-11-03%20at%2016.55.30.png" width="600">

## 3.BÃ i táº­p 14

::: tip ğŸ’¡ MÃ” HÃŒNH

XÃ¢y dá»¥ng há»‡ thá»‘ng máº¡ng theo mÃ´ hÃ¬nh sau:

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/03-23-16-21-Screen%20Shot%202021-11-03%20at%2023.16.17.png">
:::

### Táº¡o thÆ° má»¥c vÃ  cÃ¡c file

Táº¡o cÃ¡c thÆ° má»¥c vÃ  file theo mÃ´ hÃ¬nh nhÆ° sau:

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-33-07-Screenshot%20from%202021-11-04%2015-32-32.png">

Báº±ng cÃ¡ch lá»‡nh sau:

```sh
mkdir ~/Desktop/BaiTap14
cd ~/Desktop/BaiTap14
mkdir pc2 pc3 router1 router2 router3 routerisp
touch lab.conf pc2.startup pc3.startup router1.startup router2.startup router3.startup routerisp.startup
```

### Thiáº¿t láº­p cÃ¡c file

Cáº¥u hÃ¬nh vÃ  thiáº¿t láº­p cÃ¡c thÆ° má»¥c vá»«a táº¡o nhÆ° sau:

:::: tabs

  ::: tab lab.conf
  ```txt
  pc2[0]=B
  pc3[0]=C

  router1[0]=A
  router1[1]=D
  router1[2]=E

  router2[0]=B
  router2[1]=D
  router2[2]=F

  router3[0]=C
  router3[1]=E
  router3[2]=F

  routerisp[0]=A
  ```
  :::

  ::: tab router1.startup
  ```txt
  ifconfig eth0 200.117.68.1/30 up
  ifconfig eth1 10.0.1.1/30 up
  ifconfig eth2 10.0.1.5/30 up
  /etc/init.d/quagga start 
  ```
  :::

  ::: tab router2.startup
  ```txt
  ifconfig eth0 192.168.1.1/24 up
  ifconfig eth1 10.0.1.2/30 up
  ifconfig eth2 10.0.1.9/30 up
  /etc/init.d/quagga start 
  ```
  :::

  ::: tab router3.startup
  ```txt
  ifconfig eth0 192.168.2.1/24 up
  ifconfig eth1 10.0.1.6/30 up
  ifconfig eth2 10.0.1.10/30 up
  /etc/init.d/quagga start 
  ```
  :::

  ::: tab routerisp.startup
  ```txt
  ifconfig eth0 200.117.68.2/30 up
  route add default gw 200.117.68.1
  ```
  :::

  ::: tab pc2.startup
  ```txt
  ifconfig eth0 192.168.1.200/24 up
  route add default gw 192.168.1.1
  ```
  :::

  ::: tab pc3.startup
  ```txt
  ifconfig eth0 192.168.2.111/24 up
  route add default gw 192.168.2.1
  ```
  :::
::::

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-21-06-12-Screen%20Shot%202021-11-04%20at%2021.06.05.png">

###  Cáº¥u hÃ¬nh Quagga

Trong má»—i thÆ° viá»‡n `router` hÃ£y táº¡o má»¥c nhÆ° sau:

:::: tabs 

  ::: tab daemons
  ```txt
  zebra=yes
  ripd=yes
  ```
  :::

  ::: tab zebra.conf
  ```txt
  hostname zebra
  password zebra
  enable password zebra

  log file /var/log/zebra/zebra.log
  ```
  :::

  ::: tab ripd.conf
  ```txt
  hostname ripd
  password zebra
  enable password zebra

  router rip
  network 10.0.1.0/28
  redistribute connected

  log file /var/log/zebra/ripd.log
  ```  
  :::
::::

::: warning âš ï¸ LÆ¯U Ã

NhÆ° mÃ´ hÃ¬nh Ä‘á» bÃ i thÃ¬ `routerISP` khÃ´ng thuá»™c pháº¡m vá»‹ dá»‹ch vá»¥ `Quagga` nÃªn ta bá» khÃ´ng cáº¥u hÃ¬nh `Quagga` cho `routerISP`
:::

::: tip ğŸ’¡  Máº¸O

Sá»­ dá»¥ng lá»‡nh sau Ä‘á»ƒ copy qua cÃ¡c router cÃ²n láº¡i 

```sh
cp -r router1/etc router2
cp -r router1/etc router3
```
:::

### Khá»Ÿi Ä‘á»™ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `kathara lstart` Ä‘á»ƒ khá»Ÿi táº¡o há»‡ thá»‘ng mÃ¡y áº£o:

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-35-46-Screen%20Shot%202021-11-04%20at%2015.35.43.png">
>
> ==> KhÃ´ng bÃ¡o lá»—i, Ä‘Ã£ thÃ nh cÃ´ng cháº¡y há»‡ thá»‘ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh sau Ä‘Ã¢y trÃªn tá»«ng `router` Ä‘á»ƒ kiá»m tra dá»‹ch vá»¥ `Quagga`:

```sh
/etc/init.d/quagga status
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-39-17-Screen%20Shot%202021-11-04%20at%2015.38.06.png">

### Kiá»ƒm tra mÃ¡y áº£o

#### TÃ­nh liÃªn thÃ´ng cá»§a cÃ¡c router

#### Tá»« `routerISP` tá»›i cÃ¡c `router` khÃ¡c

```sh
ping 200.117.68.1 -c 5 #router1
ping 192.168.1.1 -c 5 #router2
ping 192.168.2.1 -c 5 #router3
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-45-44-Screenshot%20from%202021-11-04%2015-44-16.png">

==> ThÃ nh cÃ´ng
#### Tá»« `router` báº¥t ká»³ tá»›i `routerISP`

```sh
ping 200.117.68.2 -c 3
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-47-16-Screen%20Shot%202021-11-04%20at%2015.47.09.png">

==> ThÃ nh cÃ´ng

#### Tá»« `pc2` tá»›i `pc3` vÃ  ngÆ°á»£c láº¡i

```sh
ping 192.168.2.111 -c 3 #tá»« pc2 sang pc3
ping 192.168.1.200 -c 3 #tá»« pc3 sang pc2
```


> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-15-49-57-Screen%20Shot%202021-11-04%20at%2015.49.53.png" width="400">

==> ThÃ nh cÃ´ng

#### Tá»« `pc2` vÃ  `pc3` tá»›i `routerISP` vÃ  ngÆ°á»£c láº¡i

```sh
ping 200.217.68.2 -c 5 #gÃµ trÃªn pc2 vÃ  pc3
ping 192.168.2.111 #gÃµ trÃªn routerISP
ping 192.168.1.200 #gÃµ trÃªn routerISP
```

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-21-08-37-Screen%20Shot%202021-11-04%20at%2021.08.32.png" width="400">

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-21-09-27-Screen%20Shot%202021-11-04%20at%2021.09.23.png" width="400">

::: tip ğŸ’¡ NHáº¬N XÃ‰T

- CÃ¡c router trong há»‡ thá»‘ng `ping` Ä‘Æ°á»£c cho nhau

- 2 thiáº¿t bá»‹ `pc2` vÃ  `pc3` ping Ä‘Æ°á»£c cho nhau

- `pc2` vÃ  `pc3` gá»­i Ä‘Æ°á»£c `ICMP echo request` cho `routerISP` nhÆ°ng `routerISP` khÃ´ng gá»­i Ä‘Æ°á»£c `ICMP echo reply` Ä‘áº¿n `pc2` vÃ  cáº£ `pc3` (*vÃ¬ `routerISP` khÃ´ng náº±m trong Ä‘á»‹nh tuyáº¿n ná»™i bá»™ vÃ  chá»‰ liÃªn káº¿t vá»›i `router1`*)
:::

### Há»§y há»‡ thá»‘ng mÃ¡y áº£o

Sá»­ dá»¥ng lá»‡nh `kathara lclean` Ä‘á»ƒ há»§y há»‡ thá»‘ng mÃ¡y áº£o:

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/04-23-41-22-Screen%20Shot%202021-11-04%20at%2023.41.17.png" width="600">


<comment/>

# Th·ª±c h√†nh bu·ªïi 4

::: tip üìÅ T√ÄI NGUY√äN

[Download t√†i li·ªáu bu·ªïi 4](https://drive.google.com/uc?id=1yC_AMzdyaNDbFktZ4c_-FTfnK1b0Bt1z&export=view)
:::

## Ki·∫øn th·ª©c

### ƒê·ªãnh tuy·∫øn n·ªôi mi·ªÅn

- L√† nh√≥m c√°c m·∫°ng `LAN` v√† `router` c√≥ chung ch√≠nh s√°ch qu·∫£n tr·ªã.

- C√°c gi·∫£i thu·∫≠t m√† `router` s·ª≠ d·ª•ng ƒë·ªÉ v·∫°ch ƒë∆∞·ªùng g·ªçi l√† `IGP` (*Interior GateWay Protocol*).

::: üí° tip Gi·∫£i thu·∫≠t <code>RIP</code> v√†  <code>OSPF</code>

- `RIP` (*[Routing Information Protocol](https://en.wikipedia.org/wiki/Routing_Information_Protocol))*: s·ª≠ d·ª•ng gi·∫£i thu·∫≠t `Distance Vector` (*theo nguy√™n l√Ω [bellman-Ford](https://vi.wikipedia.org/wiki/Thu%E1%BA%ADt_to%C3%A1n_Bellman%E2%80%93Ford)*), phi√™n b·∫£n `RIP` version **2**:

  1. ƒê∆°n v·ªã ƒëo kho·∫£ng c√°ch d√πng trong v·∫°ch ƒë∆∞·ªùng l√† `hops`

  2. S·ªë l∆∞·ª£ng s·ªë b∆∞·ªõc nh·∫£y t·ªëi ƒëa l√† `15`

  3. Ch√π k·ª≥ c·∫≠p nh·∫≠t b·∫£ng v·∫°ch ƒë∆∞·ªùng l√† `30s` (*c√≥ th·ªÉ t√πy ch·ªânh*)

  4. T·∫ßng v·∫≠n chuy·ªÉn s·ª≠ d·ª•ng [UDP](https://vi.wikipedia.org/wiki/UDP) v·ªõi c·ªïng l√† `520`

  5. H·ªó tr·ª£ [CIDR](https://quantrimang.com/cidr-la-gi-165535) v√† [MD5](https://vi.wikipedia.org/wiki/MD5)

  ==> Ph√π h·ª£p tri·ªÉn khai tr√™n c√°c **ƒë·ªãnh tuy·∫øn n·ªôi mi·ªÅn** c√≥ k√≠ch th∆∞·ªõc nh·ªè v√† kh√¥ng ph·ª©c t·∫°p

- `OSPF` (*[Open Shortest Path First](https://vi.wikipedia.org/wiki/OSPF)*): s·ª≠ d·ª•ng gi·∫£i thu·∫≠t `LSP` (*Link State Packet*) d·ª±a tr√™n thu·∫≠t to√°n [Dijkstra](https://vi.wikipedia.org/wiki/Thu%E1%BA%ADt_to%C3%A1n_Dijkstra), phi√™n b·∫£n `OSPF` version **2**

  1. H·ªôi t·ª• nhanh v√† kh√¥ng c√≥ t√¨nh tr·∫∑ng l·∫∑p v√¥ t·∫≠n vi·ªác v·∫°ch ƒë∆∞·ªùng
  
  2. H·ªó tr·ª£ m·∫°ng k√≠ch th∆∞·ªõc l·ªõn

  3. H·ªó tr·ª£ [CIDR](https://quantrimang.com/cidr-la-gi-165535) v√† [MD5](https://vi.wikipedia.org/wiki/MD5)

  ==> Ph√π h·ª£p tri·ªÉn khai tr√™n c√°c **ƒë·ªãnh tuy·∫øn n·ªôi mi·ªÅn** c√≥ k√≠ch th∆∞·ªõc l·ªõn v√† ph·ª©c t·∫°p
:::

::: warning ‚ö†Ô∏è L∆ØU √ù

- Trong `kathara` ƒë·ªÉ s·ª≠ d·ª•ng **ƒë·ªãnh tuy·∫øn n·ªôi mi·ªÅn** s·ª≠ d·ª•ng c√¥ng c·ª• c√≥ s·∫µn l√† `Quagga`: l√† d·ªãch v·ª• ch·ª©a c√°c gi·∫£i thu·∫≠t v·∫°ch ƒë∆∞·ªùng nh∆∞ `RIPv2` v√† `OSPFv2` ho·∫°t ƒë·ªông t·ªët tr√™n `IPv4`, `IPv6`...

- ƒê∆∞·ª£c c√†i ƒë·∫∑t t·∫°i ƒë∆∞·ªùng d·∫´n `/etc/quagga` trong m√°y ·∫£o `Kathara`
:::

## 1. B√†i t·∫≠p 12

::: tip üí° M√î H√åNH

X√¢y d·ª±ng h·ªá th·ªëng m·∫°ng v·ªõi m√¥ h√¨nh nh∆∞ sau : 

<img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/17-18-52-12-Screen%20Shot%202021-10-17%20at%2018.52.04.png">
:::

### T·∫°o th∆∞ m·ª•c v√† c√°c file


```sh
mkdir ~/Desktop/BaiTap12
cd ~/Desktop/BaiTap12
mkdir router1 router2 router3 router4 
touch lab.conf router1.startup router2.startup router3.startup router4.startup
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-16-57-29-Screenshot%20from%202021-10-31%2014-36-10.png" width="500">

### Thi·∫øt l·∫≠p c√°c file

:::: tabs

  ::: tab lab.conf
  ```txt
  router1[0]=H
  router1[1]=G
  router1[2]=E
  router1[3]=A

  router2[0]=E
  router2[1]=F
  router2[2]=B

  router3[0]=F
  router3[1]=G
  router3[2]=I
  router3[3]=C

  router4[0]=D
  router4[1]=I
  router4[2]=H
  ```
  :::

  ::: tab router1.startup
  ```txt
  ifconfig eth0 100.1.0.13/30 up
  ifconfig eth1 100.1.0.9/30 up
  ifconfig eth2 100.1.0.1/30 up
  ifconfig eth3 100.1.1.1/24 up
  /etc/init.d/quagga start
  ```
  :::

  ::: tab router2.startup
  ```txt
  ifconfig eth0 100.1.0.2/30 up
  ifconfig eth1 100.1.2.1/24 up
  ifconfig eth2 100.1.2.1/24 up
  /etc/init.d/quagga start
  ```
  :::
  
  ::: tab router3.startup
  ```txt
  ifconfig eth0 100.1.0.6/30 up
  ifconfig eth1 100.1.0.10/30 up
  ifconfig eth2 100.1.0.17/30 up
  ifconfig eth3 100.1.3.1/24 up
  /etc/init.d/quagga start
  ```
  :::

  ::: tab router4.startup
  ```txt
  ifconfig eth0 100.1.4.1/24 up
  ifconfig eth1 100.1.0.18/30 up
  ifconfig eth2 100.1.0.14/30 up
  /etc/init.d/quagga start
  ```
  :::
::::

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-15-22-49-Screen%20Shot%202021-10-31%20at%2015.22.42.png" width="600">

::: tip üí° Gi·∫£i th√≠ch

L·ªánh `etc/init.d/quagga start`: ƒë·ªÉ kh·ªüi ƒë·ªông d·ªãch v·ª• `Quagga`
:::
### C·∫•u h√¨nh `Quagga`

Trong m·ªói th∆∞ vi·ªán `router` h√£y t·∫°o th∆∞ m·ª•c v√† c·∫•u h√¨nh nh∆∞ sau : 

```txt-no:no-line-numbers
-- router1
   -- etc
      -- quagga
       + daemons
       + ripd.conf
       + zebra.conf
```

:::: tabs

  ::: tab daemons
  ```txt
  zebra=yes
  ripd=yes
  ```
  :::

  ::: tab zebra.conf
  ```txt
  hostname zebra
  password zebra
  enable password zebra
  log file /var/log/zebra/zebra.log
  ```
  :::

  ::: tab rip.conf
  ```txt
  hostname ripd
  password zebra
  enable password zebra

  router rip
  network 100.1.0.0/16
  redistribute connected
  log file /var/log/zebra/ripd.log
  ``` 
  :::
::::

::: tip üí° GI·∫¢I TH√çCH

- `zebra.conf`: ch·ª©a n·ªôi dung mi√™u t·∫£ cho c√¥ng c·ª• `Quagga` nh∆∞ : 
  
  1. username v√† password

  2. ƒê∆∞·ªùng d·∫´n nh·∫≠t k√Ω (`log file`)

- `daemons`: ch·ª©a khai b√°o c√°c giao th·ª©c v·∫°ch ƒë∆∞·ªùng ƒë∆∞·ª£c `Quagga` h·ªó tr·ª£ nh∆∞ :

  1. `RIPv2` tr√™n `IPv4`: ƒë·∫∑t t√™n l√† `ripd`

  2. `OSPFv2` tr√™n `IPv4`: ƒë·∫∑t t√™n l√† `ospfd`

  3. `BGP` tr√™n `IPv4` v√† `IPv6`: ƒë·∫∑t t√™n l√† `bgpd`

- `ripd.conf`: ch·ª©a n·ªôi dung mi√™u t·∫£ ho·∫°t ƒë·ªông c·ªßa gi·∫£i thu·∫≠t `RIPv2`

  1. L·ªánh `router rip`: cho bi·∫øt router s·∫Ω s·ª≠ d·ª•ng `RIPv2` l√†m v·∫°ch ƒë∆∞·ªùng 

  2. L·ªánh `network`: l√† ph·∫°m vi g·ª≠i v√† nh·∫≠n g√≥i tin, c√≥ th·ªÉ s·ª≠ d·ª•ng `ip` kh√°c d∆∞·ªõi `24`

  3. L·ªánh `redistribute connected`: cho ph√©p router ƒë√≥ng g√≥i c√°c th√¥ng tin v·ªÅ nh·ªØng nh√°nh m·∫°ng 
:::

::: tip üí°  M·∫∏O

S·ª≠ d·ª•ng l·ªánh sau ƒë·ªÉ copy qua c√°c router c√≤n l·∫°i 

```sh
cp -r router1/etc router2
cp -r router1/etc router3
cp -r router1/etc router4
```
:::

S·ª≠ d·ª•ng l·ªánh `tree` ƒë·ªÉ xem c·∫•u tr√∫c file (*c√†i b·∫±ng l·ªánh sau:* `sudo apt install tree`)

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/10/31-17-33-18-Screen%20Shot%202021-10-31%20at%2017.33.08.png" width="250">

### Kh·ªüi ƒë·ªông m√°y ·∫£o

S·ª≠ d·ª•ng d·ª•ng l·ªánh sau ƒë·ªÉ kh·ªüi t·∫°o c√°c m√°y ·∫£o `Kathara` v·ª´a kh·ªüi t·∫°o :

```sh
kathara lstart
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-13-38-21-Screen%20Shot%202021-10-31%20at%2017.40.46.png">
>
> V·∫≠y l√† b·∫°n ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª• `Quagga` th√†nh c√¥ng.

S·ª≠ d·ª•ng l·ªánh sau ƒë·ªÉ ki·ªÉm tra d·ªãch v·ª• `Quagga`

```sh
/etc/init.d/quagga status
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-13-41-18-Screen%20Shot%202021-11-01%20at%2013.41.12.png">
>
> 1. N·∫øu kh√¥ng hi·ªán g√¨ c·∫£ ==> d·ªãch v·ª• ch∆∞a ƒë∆∞·ª£c kh·ªüi ƒë·ªông
>
> 2. `ripd watchquagga` ==> thi·∫øt l·∫≠p cho `RIPv2` v√† `Quagga` ƒë√£ th√†nh c√¥ng
>
> 3. `watchquagga` ==> c√≥ sai s√≥t tr√™n `ripd.conf` n√™n `RIPv2` kh√¥ng ho·∫°t ƒë·ªông

### Nh·∫≠n x√©t m√°y ·∫£o

S·ª≠ d·ª•ng l·ªánh `route` ƒë·ªÉ ki·ªÉm tra v·∫°ch ƒë∆∞·ªùng tr√™n c√°ch m√°y ·∫£o :

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-15-51-55-Screen%20Shot%202021-11-01%20at%2015.51.50.png">

#### Ki·ªÉm tra ping 

T·ª´ `router1` h√£y ping t·ªõi `router4` v√† t·ª´ `router2` ƒë·∫øn `router4` b·∫±ng l·ªánh sau:

```sh
# th·ª±c hi·ªán tr√™n pc1
ping 100.1.4.1 -c 5 
# th·ª±c hi·ªán tr√™n pc2
ping 100.1.0.10 -c 5
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-15-54-40-Screen%20Shot%202021-11-01%20at%2015.54.36.png">

#### Ki·ªÉm tra `tcpdump`

S·ª≠ d·ª•ng l·ªánh `tcpdump` sau ƒë√¢y tr√™n `router1` ƒë·ªÉ ki·ªÉm tra ƒë∆∞·ªùng ƒëi c√°c g√≥i tin

```sh
tcmpdump -i any -w /shared/BaiTap12_router1.pcap
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-03-06-Screen%20Shot%202021-11-01%20at%2016.02.55.png">

::: warning L∆ØU √ù

S·ª≠ d·ª•ng `CRTL+C` ƒë·ªÉ d·ª´ng sau t·∫ßm `20s`
:::

#### Ki·ªÉm tra `telnet`

Tr√™n `router` b·∫•t k·ª≥ s·ª≠ d·ª•ng l·ªánh sau ƒë·ªÉ ƒëƒÉng nh·∫≠p v√†o d·ªãch v·ª• `RIPv2`:

```sh
telnet localhost ripd
```

> Password : `zebra`
 
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-56-04-Screen%20Shot%202021-11-01%20at%2016.55.57.png">

Sau ƒë√≥ tr√™n giao di·ªán `ripd`, s·ª≠ d·ª•ng l·ªánh:

```sh
show ip rip
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-16-58-08-Screen%20Shot%202021-11-01%20at%2016.58.05.png">

### Ph√¢n t√≠ch pcap b·∫±ng WireShark

M·ªü g√≥i `BaiTap12_router1.pcap` trong th∆∞ m·ª•c `shared` b·∫±ng `WireShark` v√† ch·ªçn g√≥i tin c√≥ ƒë·ªãa ch·ªâ `100.1.0.10` (*router3*)

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-24-37-Screen%20Shot%202021-11-01%20at%2017.23.43.png">

::: tip Nh·∫≠n X√âT

- ƒê·ªãa ch·ªâ IP ƒë√≠ch c·ªßa khung n√†y l√† `224.0.0.9`, n√≥ l√† ƒë·ªãa ch·ªâ `Multicast` (*v√¨ c√°c `packages` g·ª≠i ƒë·∫øn nh·ªØng ƒë√≠ch m√† n√≥ c√πng giao th·ª©c m·∫°ng v·ªõi ngu·ªìn*)

- G√≥i tin s·ª≠ d·ª•ng giao th·ª©c tr√™n **t·∫ßng v·∫≠n chuy·ªÉn l√†** `user datagram`, v√† ho·∫°t ƒë·ªông ·ªü c·ªïng `520`

- Trong tr∆∞·ªùng `Routing Infomation Protocol` ƒë√¢y l√† b·ªô ƒë·ªãnh tuy·∫øn s·ª≠ d·ª•ng gi·∫£i thu·∫≠t `RIPv2`

- Ngo√†i g√≥i tin `RIPv2` c√≥ ƒë·ªãa ch·ªâ `100.1.0.10` th√¨ `router3` c√≤n nh·∫≠n d·ªØ li·ªáu c·ªßa c√°c `router 1`, `routere2` v√† `router4`
:::

### T·∫Øt m·ªôt nh√°nh m·∫°ng

Tr√™n `router1` th·ª±c hi·ªán t·∫Øt nh√°nh m·∫°ng `eth1` b·∫±ng l·ªánh

```sh
ifconfig eth1 down
```

> ƒêi·ªÅu n√†y s·∫Ω l√†m cho m√¥ h√¨nh m·∫°ng nh∆∞ sau:
> 
> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-30-09-Screen%20Shot%202021-11-01%20at%2017.29.39.png" width="500">

Tr√™n `router1` th·ª±c hi·ªán **ping** t·ªõi `router3` b·∫±ng l·ªánh

```sh
ping 100.1.0.10 -c 7
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-32-43-Screen%20Shot%202021-11-01%20at%2017.32.38.png">
>
> Kh√¥ng th√†nh c√¥ng v√¨ l√∫c n√†y ƒë√£ m·∫•t ƒë∆∞·ªùng li√™n k·∫øt t·ªõi `router3`

Th·ª±c hi·ªán ki·ªÉm tra b·∫£ng v·∫°ch ƒë∆∞·ªùng b·∫±ng `route` c·ªßa `router1`:

| C≈©                                                                                                                                                                      | M·ªõi                                                                                                                                                                     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-35-14-Screen%20Shot%202021-11-01%20at%2017.35.03.png" width="600"> | <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-34-24-Screen%20Shot%202021-11-01%20at%2017.34.16.png" width="600"> |

==> C·ª• th·ªÉ kh√¥ng c√≤n li√™n k·∫øt n√†o ·ªü `eth1` nh∆∞ tr√™n, giao di·ªán `eth2` c·ªßa `router1` s·∫Ω thay th·∫ø giao di·ªán `eth1` ƒë√£ b·ªã t·∫Øt ƒëi

::: tip K·∫æT LU·∫¨N

Gi·∫£i thu·∫≠t `RIPv2` tr√™n `router` t·ª± ƒë·ªông c·∫≠p nh·∫≠t l·∫°i ƒë∆∞·ªùng ƒëi khi c·∫•u tr√∫c m·∫°ng thay ƒë·ªïi ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë∆∞·ªùng truy·ªÅn t·∫£i v·ªõi ƒë∆∞·ªùng ƒëi ng·∫Øn nh·∫•t v√† kh√¥ng b·ªã m·∫•t m√°t d·ªØ li·ªáu
:::

### H·ªßy m√°y ·∫£o

S·ª≠ d·ª•ng l·ªánh `kathara` sau ƒë·ªÉ h·ªßy h·ªá th·ªëng m√°y ·∫£o

```sh
kathara lclean
```

> <img src="https://raw.githubusercontent.com/Zenfection/Image/master/2021/11/01-17-40-06-Screen%20Shot%202021-11-01%20at%2017.40.02.png" width="600">

<comment/>
